/**
 * Copyright (c) 2016 - 2020 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const Code = require('code');
const Lab = require('lab');
const lab = exports.lab = Lab.script();

const describe = lab.describe;
const it = lab.it;
const expect = Code.expect;

const Index = require('../index');
const Log = require('../lib/logger');
const Manifest = require('../manifest');

describe('index', () => {

    describe('Interfaces', () => {

        it('should not provide any interface', { plan: 1 }, (done) => {

            const Interfaces = require('../lib/interfaces');
            try {
                Interfaces.ecosystemInterface.x;
            }
            catch (e) {
                expect(e).to.exist();
            }
            done();
        });
    });

    describe('init', () => {

        it('should init the module and set the logger', { plan: 3 }, (done) =>  {

            const Log0 = Log.Logger;
            Manifest.transport.enabled = false;
            Log.Logger.DEBUG('x'); // do nothing
            const Logger = {
                ERROR: done,
                INFO: function (arg) {

                    expect(arg).to.equal('Ecosystem module init');
                },
                DEBUG: function (arg) {

                    expect(arg).to.equal('hello');
                    Manifest.transport.enabled = true;
                    Log.Logger = Log0;
                    done();
                }
            };
            Index.init(Logger);
            expect(Log.Logger).to.equal(Logger);
            Log.Logger.DEBUG('hello');
        });
    });
});
